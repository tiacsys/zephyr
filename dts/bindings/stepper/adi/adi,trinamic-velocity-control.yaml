# SPDX-FileCopyrightText: Copyright (c) 2025 Navimatix GmbH
# SPDX-License-Identifier: Apache-2.0

description: Velocity Control configuration options for Trinamic stepper controllers.

properties:
  ihold:
    type: int
    default: 0
    description: |
      Hold current in % of run current (0-100)
      Standstill current (0=1/32…31=32/32)
      In combination with StealthChop mode, setting IHOLD=0 allows to choose freewheeling or coil
      short circuit for motor stand still

  irun:
    type: int
    default: 0
    description: |
      Motor run current (0=1/32…31=32/32)
      Hint: Choose sense resistors in a way, that normal
      IRUN is 16 to 31 for best microstep performance.

  iholddelay:
    type: int
    default: 0
    description: |
      Controls the number of clock cycles for motor power down after a motion as soon as driver
      specific delays have expired. The smooth transition avoids a motor jerk upon power down.
      0: instant power down
      1..15: Delay per current reduction step in multiple of 2^18 clocks

  tcoolthrs:
    type: int
    default: 0
    description: |
      This is the lower threshold velocity for switching on smart
      energy CoolStep and StallGuard feature. (unsigned)
      Set this parameter to disable CoolStep at low speeds, where it
      cannot work reliably. The stop on stall function (enable with
      sg_stop when using internal motion controller) and the stall
      output signal become enabled when exceeding this velocity. In
      non-DcStep mode, it becomes disabled again once the velocity
      falls below this threshold.
      TCOOLTHRS ≥ TSTEP ≥ THIGH:
      - CoolStep is enabled, if configured
      - StealthChop voltage PWM mode is disabled
      TCOOLTHRS ≥ TSTEP
      - Stop on stall is enabled, if configured
      - Stall output signal (DIAG0/1) is enabled, if configured

  thigh:
    type: int
    default: 0
    description: |
      This velocity setting allows velocity dependent switching into
      a different chopper mode and fullstepping to maximize torque.
      (unsigned)
      The stall detection feature becomes switched off for 2-3
      electrical periods whenever passing THIGH threshold to
      compensate for the effect of switching modes.
      TSTEP ≤ THIGH:
      - CoolStep is disabled (motor runs with normal current
      scale)
      - StealthChop voltage PWM mode is disabled
      - If vhighchm is set, the chopper switches to chm=1
      with TFD=0 (constant off time with slow decay, only).
      - If vhighfs is set, the motor operates in fullstep mode,
      and the stall detection becomes switched over to
      DcStep stall detection.

  tpwmthrs:
    type: int
    default: 0
    description: |
      This is the upper velocity for StealthChop voltage PWM mode.
      TSTEP ≥ TPWMTHRS
      - StealthChop PWM mode is enabled, if configured
      - DcStep is disabled

  tpowerdown:
    type: int
    default: 10
    description: |
      TPOWERDOWN sets the delay time after stand still (stst) of the
      motor to motor current power down. Time range is about 0 to
      4 seconds.
      Attention: A minimum setting of 2 is required to allow
      automatic tuning of StealthChop PWM_OFS_AUTO.
      Reset Default = 10
      0…((2^8)-1) * 2^18 tCLK
